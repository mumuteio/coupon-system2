<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ä¼˜æƒ åˆ¸ç®¡ç†ç³»ç»Ÿï¼ˆLeanCloud + Vercelï¼‰</title>

  <!-- Tailwind Play CDN (no build step) -->
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
</head>
<body class="min-h-screen">
  <div id="root"></div>

  <!-- React (UMD) -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>

  <!-- Babel (for JSX in-browser; for productionå»ºè®®æ”¹æˆæ„å»ºæ‰“åŒ…) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" crossorigin></script>

  <!-- SheetJS (XLSX) -->
  <script src="https://cdn.sheetjs.com/xlsx-0.20.3/package/dist/xlsx.full.min.js"></script>

  <!-- LeanCloud JS SDK -->
  <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.15.2/dist/av-min.js"></script>

  <!--
    ä½ éœ€è¦æŠŠä¸‹é¢è¿™æ®µé…ç½®æ”¹æˆä½ è‡ªå·±çš„ LeanCloud ä¿¡æ¯ï¼š
    - appId / appKey: LeanCloud æ§åˆ¶å° -> åº”ç”¨å‡­è¯
    - serverURL: LeanCloud æ§åˆ¶å° -> åº”ç”¨ -> è®¾ç½® -> æœåŠ¡å™¨åœ°å€ï¼ˆæˆ–æŒ‰åœ°åŸŸï¼‰
  -->
  <script>
    window.__LEANCLOUD__ = {
      appId: "bCLynCo8QvMsJWAohEF2ngA2-gzGzoHsz",
      appKey: "iYGSA2eB8sS1nuAHQFutxeYM",
      serverURL: "https://bclynco8.lc-cn-n1-shared.com"
    };
  </script>

  <script type="text/babel">
    const { useEffect, useMemo, useState } = React;

    const EmojiIcon = ({ label, size = 18, title }) => (
      <span
        title={title || label}
        style={{
          display: "inline-flex",
          width: size,
          height: size,
          alignItems: "center",
          justifyContent: "center",
          fontSize: size,
          lineHeight: 1
        }}
        aria-hidden="true"
      >
        {label}
      </span>
    );

    function CouponSystem() {
      const [coupons, setCoupons] = useState([]);
      const [searchTerm, setSearchTerm] = useState("");
      const [editingId, setEditingId] = useState(null);
      const [sortConfig, setSortConfig] = useState({ key: null, direction: "asc" });
      const [selectedCoupon, setSelectedCoupon] = useState("");
      const [loading, setLoading] = useState(true);
      const [isOnline, setIsOnline] = useState(navigator.onLine);
      const [error, setError] = useState(null);

      const [issueFormData, setIssueFormData] = useState({ issueDate: "", remarks: "" });
      const [redeemFormData, setRedeemFormData] = useState({ redeemDate: "", remarks: "" });
      const [formData, setFormData] = useState({ couponCode: "", issueDate: "", redeemDate: "", remarks: "" });

      const lc = window.__LEANCLOUD__ || {};
      const isLcConfigured = lc.appId && lc.appKey && lc.serverURL &&
        !String(lc.appId).includes("YOUR_") && !String(lc.appKey).includes("YOUR_") && !String(lc.serverURL).includes("YOUR_");

      const COUPON_CLASS = "Coupon"; // LeanCloud æ•°æ®è¡¨ï¼ˆClassï¼‰åç§°

      const initLeanCloud = () => {
        if (!window.AV) throw new Error("LeanCloud SDK æœªåŠ è½½ï¼ˆAV ä¸å­˜åœ¨ï¼‰");
        if (!isLcConfigured) return;
        // é¿å…é‡å¤ init
        if (window.__LC_INITED__) return;
        AV.init({ appId: lc.appId, appKey: lc.appKey, serverURL: lc.serverURL });
        window.__LC_INITED__ = true;
      };

      const timeOf = (c) => {
        const t = new Date(c.createdAt || 0).getTime();
        return Number.isFinite(t) ? t : 0;
      };

      const fetchCoupons = async () => {
        if (!isLcConfigured) {
          setCoupons([]);
          setLoading(false);
          return;
        }
        try {
          setError(null);
          const query = new AV.Query(COUPON_CLASS);
          query.limit(1000);
          query.descending("createdAt");
          const results = await query.find();
          const mapped = results.map(obj => ({
            id: obj.id,
            couponCode: obj.get("couponCode") || "",
            issueDate: obj.get("issueDate") || "",
            redeemDate: obj.get("redeemDate") || "",
            remarks: obj.get("remarks") || "",
            createdAt: obj.createdAt ? obj.createdAt.toISOString() : "",
            updatedAt: obj.updatedAt ? obj.updatedAt.toISOString() : ""
          }));
          // ä¿æŒâ€œä»æ—§åˆ°æ–°â€çš„æ˜¾ç¤ºä¹ æƒ¯ï¼ˆä½ ä¹Ÿå¯ä»¥æ”¹æˆ new->oldï¼‰
          setCoupons(mapped.reverse());
        } catch (err) {
          console.error("LeanCloud è¯»å–é”™è¯¯:", err);
          setError("æ•°æ®åŠ è½½å¤±è´¥: " + (err.message || String(err)));
        } finally {
          setLoading(false);
        }
      };

      useEffect(() => {
        try {
          initLeanCloud();
        } catch (e) {
          setError(e.message || String(e));
          setLoading(false);
          return;
        }

        setLoading(true);
        fetchCoupons();

        const handleOnline = () => setIsOnline(true);
        const handleOffline = () => setIsOnline(false);
        window.addEventListener("online", handleOnline);
        window.addEventListener("offline", handleOffline);

        // ç®€å•è½®è¯¢ï¼ˆæ¨¡æ‹Ÿâ€œå¤šäººåä½œçš„è¿‘å®æ—¶åˆ·æ–°â€ï¼‰
        const timer = setInterval(() => {
          if (navigator.onLine && isLcConfigured) fetchCoupons();
        }, 8000);

        return () => {
          clearInterval(timer);
          window.removeEventListener("online", handleOnline);
          window.removeEventListener("offline", handleOffline);
        };
      }, []);

      const saveToLeanCloud = async (payload) => {
        if (!isOnline) {
          alert("å½“å‰ç½‘ç»œç¦»çº¿ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥");
          return false;
        }
        if (!isLcConfigured) {
          alert("LeanCloud æœªé…ç½®ï¼šè¯·å…ˆåœ¨ index.html é‡Œå¡«å†™ appId/appKey/serverURL");
          return false;
        }
        try {
          setError(null);
          if (payload.id) {
            const obj = AV.Object.createWithoutData(COUPON_CLASS, payload.id);
            obj.set("couponCode", payload.couponCode || "");
            obj.set("issueDate", payload.issueDate || "");
            obj.set("redeemDate", payload.redeemDate || "");
            obj.set("remarks", payload.remarks || "");
            await obj.save();
          } else {
            const obj = new AV.Object(COUPON_CLASS);
            obj.set("couponCode", payload.couponCode || "");
            obj.set("issueDate", payload.issueDate || "");
            obj.set("redeemDate", payload.redeemDate || "");
            obj.set("remarks", payload.remarks || "");
            await obj.save();
          }
          await fetchCoupons();
          return true;
        } catch (err) {
          console.error("LeanCloud ä¿å­˜å¤±è´¥:", err);
          setError("ä¿å­˜å¤±è´¥: " + (err.message || String(err)));
          return false;
        }
      };

      const deleteFromLeanCloud = async (id) => {
        if (!isOnline) {
          alert("å½“å‰ç½‘ç»œç¦»çº¿ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥");
          return false;
        }
        if (!isLcConfigured) {
          alert("LeanCloud æœªé…ç½®ï¼šè¯·å…ˆåœ¨ index.html é‡Œå¡«å†™ appId/appKey/serverURL");
          return false;
        }
        try {
          setError(null);
          const obj = AV.Object.createWithoutData(COUPON_CLASS, id);
          await obj.destroy();
          await fetchCoupons();
          return true;
        } catch (err) {
          console.error("LeanCloud åˆ é™¤å¤±è´¥:", err);
          setError("åˆ é™¤å¤±è´¥: " + (err.message || String(err)));
          return false;
        }
      };

      const handleInputChange = (e) => {
        setFormData({ ...formData, [e.target.name]: e.target.value });
      };

      const handleSubmit = async () => {
        if (!formData.couponCode || !formData.issueDate) {
          alert("è¯·å¡«å†™å¿…å¡«é¡¹ï¼šä¼˜æƒ åˆ¸ç¼–å·ã€å‘æ”¾æ—¥æœŸ");
          return;
        }

        const payload = {
          id: editingId || null,
          couponCode: formData.couponCode,
          issueDate: formData.issueDate,
          redeemDate: formData.redeemDate || "",
          remarks: formData.remarks || ""
        };

        const ok = await saveToLeanCloud(payload);
        if (ok) {
          setEditingId(null);
          setFormData({ couponCode: "", issueDate: "", redeemDate: "", remarks: "" });
        }
      };

      const handleQuickIssue = async () => {
        if (!selectedCoupon || !issueFormData.issueDate) {
          alert("è¯·é€‰æ‹©ä¼˜æƒ åˆ¸å¹¶å¡«å†™å‘æ”¾æ—¥æœŸ");
          return;
        }

        const couponRecords = coupons.filter(c => c.couponCode === selectedCoupon);
        const latestRecord = couponRecords.sort((a, b) => timeOf(b) - timeOf(a))[0];

        if (latestRecord && !latestRecord.redeemDate) {
          alert(`ä¼˜æƒ åˆ¸ ${selectedCoupon} å½“å‰åœ¨å¤–æµé€šä¸­ï¼Œæ— æ³•å‘æ”¾ï¼`);
          return;
        }

        const ok = await saveToLeanCloud({
          couponCode: selectedCoupon,
          issueDate: issueFormData.issueDate,
          redeemDate: "",
          remarks: issueFormData.remarks || ""
        });

        if (ok) {
          const code = selectedCoupon;
          setSelectedCoupon("");
          setIssueFormData({ issueDate: "", remarks: "" });
          alert(`ä¼˜æƒ åˆ¸ ${code} å‘æ”¾æˆåŠŸï¼`);
        }
      };

      const handleQuickRedeem = async (couponCode) => {
        if (!redeemFormData.redeemDate) {
          alert("è¯·å¡«å†™ä½¿ç”¨æ—¥æœŸ");
          return;
        }

        const records = coupons.filter(c => c.couponCode === couponCode);
        const latestUnredeemed = records
          .filter(c => c.issueDate && !c.redeemDate)
          .sort((a, b) => timeOf(b) - timeOf(a))[0];

        if (!latestUnredeemed) {
          alert("æœªæ‰¾åˆ°è¯¥ä¼˜æƒ åˆ¸çš„å‘æ”¾è®°å½•");
          return;
        }

        const ok = await saveToLeanCloud({
          id: latestUnredeemed.id,
          couponCode: latestUnredeemed.couponCode,
          issueDate: latestUnredeemed.issueDate,
          redeemDate: redeemFormData.redeemDate,
          remarks: (redeemFormData.remarks || latestUnredeemed.remarks || "")
        });

        if (ok) {
          const code = couponCode;
          setRedeemFormData({ redeemDate: "", remarks: "" });
          alert(`ä¼˜æƒ åˆ¸ ${code} å›æ”¶æˆåŠŸï¼`);
        }
      };

      const handleEdit = (coupon) => {
        setFormData({
          couponCode: coupon.couponCode || "",
          issueDate: coupon.issueDate || "",
          redeemDate: coupon.redeemDate || "",
          remarks: coupon.remarks || ""
        });
        setEditingId(coupon.id);
        window.scrollTo({ top: document.body.scrollHeight, behavior: "smooth" });
      };

      const handleDelete = async (id) => {
        if (!window.confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ")) return;
        await deleteFromLeanCloud(id);
      };

      const handleCancelEdit = () => {
        setEditingId(null);
        setFormData({ couponCode: "", issueDate: "", redeemDate: "", remarks: "" });
      };

      const exportToExcel = () => {
        if (!window.XLSX) {
          alert("XLSX åº“æœªåŠ è½½ï¼Œæ— æ³•å¯¼å‡º");
          return;
        }
        if (coupons.length === 0) {
          alert("æ²¡æœ‰æ•°æ®å¯å¯¼å‡º");
          return;
        }

        const exportData = coupons.map(c => ({
          "ä¼˜æƒ åˆ¸ç¼–å·": c.couponCode,
          "å‘æ”¾æ—¥æœŸ": c.issueDate,
          "ä½¿ç”¨æ—¥æœŸ": c.redeemDate || "æœªä½¿ç”¨",
          "å¤‡æ³¨": c.remarks || "",
          "åˆ›å»ºæ—¶é—´": c.createdAt ? new Date(c.createdAt).toLocaleString("zh-CN") : ""
        }));

        const ws = XLSX.utils.json_to_sheet(exportData);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "ä¼˜æƒ åˆ¸è®°å½•");

        const fileName = `ä¼˜æƒ åˆ¸è®°å½•_${new Date().toLocaleDateString("zh-CN").replace(/\//g, "-")}.xlsx`;
        XLSX.writeFile(wb, fileName);
      };

      const handleSort = (key) => {
        let direction = "asc";
        if (sortConfig.key === key && sortConfig.direction === "asc") direction = "desc";
        setSortConfig({ key, direction });
      };

      const getLatestByCode = (code) => {
        const records = coupons.filter(c => c.couponCode === code).sort((a, b) => timeOf(b) - timeOf(a));
        return records[0] || null;
      };

      const getAvailableCoupons = () => {
        const setCodes = new Set(coupons.map(c => c.couponCode).filter(Boolean));
        const available = [];
        for (const code of setCodes) {
          const latest = getLatestByCode(code);
          if (latest && latest.redeemDate) available.push(code);
        }
        return available.sort();
      };

      const getIssuedNotRedeemed = () => {
        const setCodes = new Set(coupons.map(c => c.couponCode).filter(Boolean));
        const issued = [];
        for (const code of setCodes) {
          const latest = getLatestByCode(code);
          if (latest && latest.issueDate && !latest.redeemDate) issued.push(code);
        }
        return issued.sort();
      };

      const filteredCoupons = useMemo(() => {
        const q = searchTerm.trim().toLowerCase();
        if (!q) return coupons;
        return coupons.filter(c =>
          (c.couponCode || "").toLowerCase().includes(q) ||
          (c.remarks || "").toLowerCase().includes(q)
        );
      }, [coupons, searchTerm]);

      const sortedCoupons = useMemo(() => {
        const list = [...filteredCoupons];
        if (!sortConfig.key) return list;

        const dir = sortConfig.direction === "asc" ? 1 : -1;
        const key = sortConfig.key;

        list.sort((a, b) => {
          const aValue = (a[key] || "").toString();
          const bValue = (b[key] || "").toString();
          if (aValue < bValue) return -1 * dir;
          if (aValue > bValue) return  1 * dir;
          return 0;
        });

        return list;
      }, [filteredCoupons, sortConfig]);

      const availableCoupons = useMemo(() => getAvailableCoupons(), [coupons]);
      const issuedCoupons = useMemo(() => getIssuedNotRedeemed(), [coupons]);
      const redeemedCount = useMemo(() => coupons.filter(c => c.redeemDate).length, [coupons]);

      if (loading) {
        return (
          <div style={{
            minHeight: "100vh",
            background: "linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%)",
            display: "flex",
            alignItems: "center",
            justifyContent: "center"
          }}>
            <div style={{ textAlign: "center" }}>
              <div style={{ position: "relative", display: "inline-block" }}>
                <div style={{
                  color: "white",
                  animation: "spin 1s linear infinite",
                  marginBottom: "1rem",
                  fontSize: "48px"
                }}>â³</div>
                <div style={{
                  position: "absolute",
                  top: 0,
                  left: "50%",
                  transform: "translateX(-50%)",
                  animation: "pulse 2s infinite",
                  fontSize: "20px"
                }}>âœ¨</div>
              </div>
              <p style={{ color: "white", fontSize: "1.25rem", fontWeight: 600 }}>æ­£åœ¨åŠ è½½æ•°æ®...</p>
              <p style={{ color: "rgba(255,255,255,0.8)", fontSize: "0.875rem", marginTop: "0.5rem" }}>
                LeanCloud äº‘ç«¯åŒæ­¥ä¸­
              </p>
            </div>
            <style>{`
              @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.5} }
              @keyframes spin { from{transform:rotate(0)} to{transform:rotate(360deg)} }
            `}</style>
          </div>
        );
      }

      return (
        <div style={{
          minHeight: "100vh",
          background: "linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%)",
          padding: "1rem"
        }}>
          <style>{`
            @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.5} }
            @keyframes spin { from{transform:rotate(0)} to{transform:rotate(360deg)} }
          `}</style>

          <div className="max-w-6xl mx-auto">
            {!isLcConfigured && (
              <div className="mb-6 rounded-2xl border border-red-400/40 bg-red-500/20 backdrop-blur-sm p-4 text-red-100">
                <div className="flex items-start gap-3">
                  <div className="mt-0.5"><EmojiIcon label="âš ï¸" size={18} /></div>
                  <div className="flex-1">
                    <div className="font-semibold">LeanCloud æœªé…ç½®</div>
                    <div className="text-sm opacity-90 mt-1">
                      è¯·æ‰“å¼€ <code className="bg-black/20 px-2 py-1 rounded">index.html</code>ï¼ŒæŠŠ <b>appId / appKey / serverURL</b> å¡«å¥½å†åˆ·æ–°é¡µé¢ã€‚
                      å¦åˆ™é¡µé¢åªèƒ½å±•ç¤º UIï¼Œæ— æ³•è¯»å†™æ•°æ®ã€‚
                    </div>
                  </div>
                </div>
              </div>
            )}

            <div className="bg-white/15 backdrop-blur-xl rounded-3xl shadow-2xl p-6 md:p-8 mb-6 border border-white/20">
              <div className="flex flex-col md:flex-row justify-between items-center gap-4 mb-6">
                <div className="flex items-center gap-4">
                  <div className="bg-gradient-to-br from-yellow-400 to-orange-500 p-3 rounded-2xl shadow-lg">
                    <EmojiIcon label="âœ¨" size={22} />
                  </div>
                  <div>
                    <h1 className="text-3xl md:text-4xl font-bold text-white">ä¼˜æƒ åˆ¸ç®¡ç†ç³»ç»Ÿ</h1>
                    <p className="text-purple-200 text-sm mt-1">LeanCloud äº‘ç«¯å­˜å‚¨ Â· è½®è¯¢åˆ·æ–°ï¼ˆå¤šäººåä½œï¼‰</p>
                  </div>
                </div>
                <div className="flex items-center gap-3">
                  {isOnline ? (
                    <div className="flex items-center gap-2 bg-green-500/20 backdrop-blur-sm border border-green-400/30 text-green-100 px-4 py-2 rounded-full shadow-lg">
                      <EmojiIcon label="ğŸ“¶" size={16} />
                      <span className="text-sm font-medium">åœ¨çº¿</span>
                    </div>
                  ) : (
                    <div className="flex items-center gap-2 bg-red-500/20 backdrop-blur-sm border border-red-400/30 text-red-100 px-4 py-2 rounded-full shadow-lg">
                      <EmojiIcon label="ğŸš«" size={16} />
                      <span className="text-sm font-medium">ç¦»çº¿</span>
                    </div>
                  )}
                  <button
                    onClick={() => fetchCoupons()}
                    className="bg-white/20 hover:bg-white/30 border border-white/30 text-white px-4 py-2 rounded-full shadow-lg transition"
                    title="æ‰‹åŠ¨åˆ·æ–°"
                  >
                    <span className="flex items-center gap-2">
                      <EmojiIcon label="ğŸ”„" size={16} /> åˆ·æ–°
                    </span>
                  </button>
                </div>
              </div>

              {error && (
                <div className="bg-red-500/20 backdrop-blur-sm border border-red-400/30 text-red-100 px-4 py-3 rounded-2xl mb-6 flex justify-between items-center">
                  <span>{error}</span>
                  <button onClick={() => setError(null)} className="text-red-200 hover:text-white transition-colors">
                    <EmojiIcon label="âœ–ï¸" size={14} />
                  </button>
                </div>
              )}

              <div className="grid grid-cols-2 lg:grid-cols-4 gap-4">
                <div className="bg-gradient-to-br from-blue-500 to-cyan-600 p-5 rounded-2xl shadow-xl transform hover:scale-105 transition-all duration-300">
                  <div className="flex justify-between items-start mb-3">
                    <div className="text-blue-100 text-sm font-medium">æ€»è®°å½•</div>
                    <EmojiIcon label="ğŸ“ˆ" size={16} />
                  </div>
                  <div className="text-4xl font-bold text-white">{coupons.length}</div>
                </div>
                <div className="bg-gradient-to-br from-yellow-500 to-orange-600 p-5 rounded-2xl shadow-xl transform hover:scale-105 transition-all duration-300">
                  <div className="flex justify-between items-start mb-3">
                    <div className="text-yellow-100 text-sm font-medium">æµé€šä¸­</div>
                    <EmojiIcon label="ğŸ“¤" size={16} />
                  </div>
                  <div className="text-4xl font-bold text-white">{issuedCoupons.length}</div>
                </div>
                <div className="bg-gradient-to-br from-green-500 to-emerald-600 p-5 rounded-2xl shadow-xl transform hover:scale-105 transition-all duration-300">
                  <div className="flex justify-between items-start mb-3">
                    <div className="text-green-100 text-sm font-medium">å¯å‘æ”¾</div>
                    <EmojiIcon label="âœ¨" size={16} />
                  </div>
                  <div className="text-4xl font-bold text-white">{availableCoupons.length}</div>
                </div>
                <div className="bg-gradient-to-br from-purple-500 to-pink-600 p-5 rounded-2xl shadow-xl transform hover:scale-105 transition-all duration-300">
                  <div className="flex justify-between items-start mb-3">
                    <div className="text-purple-100 text-sm font-medium">å·²å›æ”¶</div>
                    <EmojiIcon label="ğŸ”„" size={16} />
                  </div>
                  <div className="text-4xl font-bold text-white">{redeemedCount}</div>
                </div>
              </div>
            </div>

            <div className="bg-gradient-to-br from-green-500/20 to-emerald-600/20 backdrop-blur-xl rounded-3xl shadow-2xl p-6 md:p-8 mb-6 border border-green-400/30">
              <h2 className="text-2xl font-bold text-white mb-6 flex items-center gap-3">
                <div className="bg-green-500 p-2 rounded-xl"><EmojiIcon label="ğŸ“¤" size={18} /></div>
                å¿«æ·å‘æ”¾ä¼˜æƒ åˆ¸
              </h2>

              {availableCoupons.length > 0 ? (
                <>
                  <div className="mb-6">
                    <label className="block text-green-100 text-sm font-medium mb-3">é€‰æ‹©å¯å‘æ”¾çš„ä¼˜æƒ åˆ¸</label>
                    <div className="flex flex-wrap gap-3">
                      {availableCoupons.map(code => (
                        <button
                          key={code}
                          onClick={() => setSelectedCoupon(code)}
                          className={`px-6 py-3 rounded-xl font-semibold transition-all duration-300 ${
                            selectedCoupon === code
                              ? "bg-white text-green-600 shadow-2xl scale-110"
                              : "bg-green-500/30 backdrop-blur-sm text-white hover:bg-green-500/50 border border-green-400/30"
                          }`}
                        >
                          {code}
                        </button>
                      ))}
                    </div>
                  </div>

                  {selectedCoupon && (
                    <div className="bg-white/10 backdrop-blur-xl p-6 rounded-2xl border border-white/20">
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div>
                          <label className="block text-white text-sm font-medium mb-2">å·²é€‰ä¼˜æƒ åˆ¸</label>
                          <input
                            type="text"
                            value={selectedCoupon}
                            disabled
                            className="w-full px-4 py-3 rounded-xl bg-white/20 backdrop-blur-sm border border-white/30 text-white font-bold"
                          />
                        </div>
                        <div>
                          <label className="block text-white text-sm font-medium mb-2">å‘æ”¾æ—¥æœŸ *</label>
                          <input
                            type="date"
                            value={issueFormData.issueDate}
                            onChange={(e) => setIssueFormData({ ...issueFormData, issueDate: e.target.value })}
                            className="w-full px-4 py-3 rounded-xl bg-white/90 border-0 focus:ring-2 focus:ring-green-400"
                          />
                        </div>
                        <div>
                          <label className="block text-white text-sm font-medium mb-2">å¤‡æ³¨ä¿¡æ¯</label>
                          <input
                            type="text"
                            value={issueFormData.remarks}
                            onChange={(e) => setIssueFormData({ ...issueFormData, remarks: e.target.value })}
                            placeholder="å§“åã€ç”µè¯ç­‰"
                            className="w-full px-4 py-3 rounded-xl bg-white/90 border-0 focus:ring-2 focus:ring-green-400"
                          />
                        </div>
                      </div>
                      <button
                        onClick={handleQuickIssue}
                        disabled={!isOnline}
                        className="w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-4 rounded-xl hover:from-green-600 hover:to-emerald-700 transition-all font-semibold text-lg flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed shadow-xl"
                      >
                        <EmojiIcon label="ğŸ“¤" size={18} />
                        ç¡®è®¤å‘æ”¾ä¼˜æƒ åˆ¸
                      </button>
                    </div>
                  )}
                </>
              ) : (
                <div className="text-center text-green-100 py-8 bg-white/5 rounded-2xl">
                  <p className="text-lg">æš‚æ— å¯å‘æ”¾çš„ä¼˜æƒ åˆ¸</p>
                  <p className="text-sm text-green-200 mt-2">ï¼ˆéœ€è¦â€œå‘æ”¾åå†å›æ”¶â€ä¸€æ¬¡ï¼Œæ‰ä¼šè¿›å…¥å¯å‘æ”¾åˆ—è¡¨ï¼‰</p>
                </div>
              )}
            </div>

            {issuedCoupons.length > 0 && (
              <div className="bg-gradient-to-br from-yellow-500/20 to-orange-600/20 backdrop-blur-xl rounded-3xl shadow-2xl p-6 md:p-8 mb-6 border border-yellow-400/30">
                <h2 className="text-2xl font-bold text-white mb-6 flex items-center gap-3">
                  <div className="bg-yellow-500 p-2 rounded-xl"><EmojiIcon label="ğŸ”„" size={18} /></div>
                  å¿«æ·å›æ”¶ä¼˜æƒ åˆ¸
                </h2>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                  <div>
                    <label className="block text-white text-sm font-medium mb-2">ä½¿ç”¨æ—¥æœŸ *</label>
                    <input
                      type="date"
                      value={redeemFormData.redeemDate}
                      onChange={(e) => setRedeemFormData({ ...redeemFormData, redeemDate: e.target.value })}
                      className="w-full px-4 py-3 rounded-xl bg-white/90 border-0 focus:ring-2 focus:ring-yellow-400"
                    />
                  </div>
                  <div>
                    <label className="block text-white text-sm font-medium mb-2">å¤‡æ³¨ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰</label>
                    <input
                      type="text"
                      value={redeemFormData.remarks}
                      onChange={(e) => setRedeemFormData({ ...redeemFormData, remarks: e.target.value })}
                      placeholder="è¡¥å……å¤‡æ³¨"
                      className="w-full px-4 py-3 rounded-xl bg-white/90 border-0 focus:ring-2 focus:ring-yellow-400"
                    />
                  </div>
                </div>

                <div className="flex flex-wrap gap-3">
                  {issuedCoupons.map(code => (
                    <button
                      key={code}
                      onClick={() => handleQuickRedeem(code)}
                      disabled={!isOnline}
                      className="bg-white/20 backdrop-blur-sm border border-yellow-400/30 text-white px-6 py-3 rounded-xl font-semibold hover:bg-white/30 transition-all flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                      <EmojiIcon label="ğŸ”„" size={16} />
                      {code}
                    </button>
                  ))}
                </div>
              </div>
            )}

            <div className="bg-white/10 backdrop-blur-xl rounded-3xl shadow-2xl p-6 md:p-8 border border-white/20">
              <div className="flex flex-col md:flex-row justify-between items-center gap-4 mb-6">
                <div className="relative w-full md:w-96">
                  <div className="absolute left-4 top-1/2 -translate-y-1/2 text-purple-300">
                    <EmojiIcon label="ğŸ”" size={16} />
                  </div>
                  <input
                    type="text"
                    placeholder="æœç´¢ä¼˜æƒ åˆ¸ç¼–å·æˆ–å¤‡æ³¨..."
                    value={searchTerm}
                    onChange={(e) => setSearchTerm(e.target.value)}
                    className="w-full pl-12 pr-4 py-3 bg-white/90 rounded-xl border-0 focus:ring-2 focus:ring-purple-400 text-gray-800"
                  />
                </div>

                <button
                  onClick={exportToExcel}
                  className="flex items-center gap-2 bg-gradient-to-r from-emerald-500 to-teal-600 text-white px-6 py-3 rounded-xl hover:from-emerald-600 hover:to-teal-700 transition-all font-semibold shadow-xl w-full md:w-auto"
                >
                  <EmojiIcon label="â¬‡ï¸" size={16} />
                  å¯¼å‡ºExcel
                </button>
              </div>

              <div className="overflow-x-auto rounded-2xl">
                <table className="w-full">
                  <thead className="bg-white/20 backdrop-blur-sm">
                    <tr>
                      <th
                        className="px-6 py-4 text-left text-sm font-semibold text-white cursor-pointer hover:bg-white/30 transition-colors"
                        onClick={() => handleSort("couponCode")}
                      >
                        <div className="flex items-center gap-2">
                          ä¼˜æƒ åˆ¸ç¼–å· <EmojiIcon label="â†•ï¸" size={14} />
                        </div>
                      </th>
                      <th
                        className="px-6 py-4 text-left text-sm font-semibold text-white cursor-pointer hover:bg-white/30 transition-colors"
                        onClick={() => handleSort("issueDate")}
                      >
                        <div className="flex items-center gap-2">
                          å‘æ”¾æ—¥æœŸ <EmojiIcon label="â†•ï¸" size={14} />
                        </div>
                      </th>
                      <th
                        className="px-6 py-4 text-left text-sm font-semibold text-white cursor-pointer hover:bg-white/30 transition-colors"
                        onClick={() => handleSort("redeemDate")}
                      >
                        <div className="flex items-center gap-2">
                          ä½¿ç”¨æ—¥æœŸ <EmojiIcon label="â†•ï¸" size={14} />
                        </div>
                      </th>
                      <th className="px-6 py-4 text-left text-sm font-semibold text-white">çŠ¶æ€</th>
                      <th className="px-6 py-4 text-left text-sm font-semibold text-white">å¤‡æ³¨</th>
                      <th className="px-6 py-4 text-left text-sm font-semibold text-white">æ“ä½œ</th>
                    </tr>
                  </thead>
                  <tbody className="divide-y divide-white/10">
                    {sortedCoupons.length === 0 ? (
                      <tr>
                        <td colSpan="6" className="px-6 py-12 text-center text-purple-200">
                          <p className="text-lg">æš‚æ— æ•°æ®</p>
                          <p className="text-sm mt-2">è¯·æ·»åŠ ä¼˜æƒ åˆ¸è®°å½•</p>
                        </td>
                      </tr>
                    ) : (
                      sortedCoupons.map((coupon) => (
                        <tr key={coupon.id} className="hover:bg-white/10 transition-colors">
                          <td className="px-6 py-4 text-sm font-semibold text-white">{coupon.couponCode}</td>
                          <td className="px-6 py-4 text-sm text-purple-100">{coupon.issueDate}</td>
                          <td className="px-6 py-4 text-sm text-purple-100">{coupon.redeemDate || "-"}</td>
                          <td className="px-6 py-4 text-sm">
                            <span className={`px-3 py-1 rounded-full text-xs font-semibold ${
                              coupon.redeemDate
                                ? "bg-green-500/30 text-green-100 border border-green-400/50"
                                : "bg-yellow-500/30 text-yellow-100 border border-yellow-400/50"
                            }`}>
                              {coupon.redeemDate ? "å·²ä½¿ç”¨" : "æµé€šä¸­"}
                            </span>
                          </td>
                          <td className="px-6 py-4 text-sm text-purple-100">{coupon.remarks || "-"}</td>
                          <td className="px-6 py-4 text-sm">
                            <div className="flex gap-2">
                              <button
                                onClick={() => handleEdit(coupon)}
                                className="bg-blue-500/30 backdrop-blur-sm border border-blue-400/50 text-blue-100 hover:bg-blue-500/50 p-2 rounded-lg transition-all"
                                title="ç¼–è¾‘"
                              >
                                <EmojiIcon label="âœï¸" size={16} />
                              </button>
                              <button
                                onClick={() => handleDelete(coupon.id)}
                                disabled={!isOnline}
                                className="bg-red-500/30 backdrop-blur-sm border border-red-400/50 text-red-100 hover:bg-red-500/50 p-2 rounded-lg transition-all disabled:opacity-30 disabled:cursor-not-allowed"
                                title="åˆ é™¤"
                              >
                                <EmojiIcon label="ğŸ—‘ï¸" size={16} />
                              </button>
                            </div>
                          </td>
                        </tr>
                      ))
                    )}
                  </tbody>
                </table>
              </div>
            </div>

            <div className="bg-gradient-to-br from-purple-500/20 to-pink-600/20 backdrop-blur-xl rounded-3xl shadow-2xl p-6 md:p-8 mt-6 border border-purple-400/30">
              <h2 className="text-2xl font-bold text-white mb-6 flex items-center gap-3">
                <div className="bg-purple-500 p-2 rounded-xl"><EmojiIcon label="â•" size={18} /></div>
                æ‰‹åŠ¨å½•å…¥ä¼˜æƒ åˆ¸è®°å½•
              </h2>

              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                <div>
                  <label className="block text-white text-sm font-medium mb-2">ä¼˜æƒ åˆ¸ç¼–å· *</label>
                  <input
                    type="text"
                    name="couponCode"
                    value={formData.couponCode}
                    onChange={handleInputChange}
                    className="w-full px-4 py-3 rounded-xl bg-white/90 border-0 focus:ring-2 focus:ring-purple-400"
                    placeholder="è¾“å…¥ä¼˜æƒ åˆ¸ç¼–å·"
                  />
                </div>

                <div>
                  <label className="block text-white text-sm font-medium mb-2">å‘æ”¾æ—¥æœŸ *</label>
                  <input
                    type="date"
                    name="issueDate"
                    value={formData.issueDate}
                    onChange={handleInputChange}
                    className="w-full px-4 py-3 rounded-xl bg-white/90 border-0 focus:ring-2 focus:ring-purple-400"
                  />
                </div>

                <div>
                  <label className="block text-white text-sm font-medium mb-2">ä½¿ç”¨æ—¥æœŸ</label>
                  <input
                    type="date"
                    name="redeemDate"
                    value={formData.redeemDate}
                    onChange={handleInputChange}
                    className="w-full px-4 py-3 rounded-xl bg-white/90 border-0 focus:ring-2 focus:ring-purple-400"
                  />
                </div>

                <div>
                  <label className="block text-white text-sm font-medium mb-2">å¤‡æ³¨ä¿¡æ¯</label>
                  <input
                    type="text"
                    name="remarks"
                    value={formData.remarks}
                    onChange={handleInputChange}
                    className="w-full px-4 py-3 rounded-xl bg-white/90 border-0 focus:ring-2 focus:ring-purple-400"
                    placeholder="å§“åã€ç”µè¯ç­‰"
                  />
                </div>
              </div>

              <div className="flex gap-3 flex-wrap">
                <button
                  onClick={handleSubmit}
                  disabled={!isOnline}
                  className="flex items-center gap-2 bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-8 py-3 rounded-xl hover:from-blue-600 hover:to-indigo-700 transition-all font-semibold shadow-xl disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  {editingId ? (
                    <>
                      <EmojiIcon label="ğŸ’¾" size={16} /> æ›´æ–°è®°å½•
                    </>
                  ) : (
                    <>
                      <EmojiIcon label="â•" size={16} /> æ·»åŠ è®°å½•
                    </>
                  )}
                </button>

                {editingId && (
                  <button
                    onClick={handleCancelEdit}
                    className="flex items-center gap-2 bg-white/20 backdrop-blur-sm border border-white/30 text-white px-8 py-3 rounded-xl hover:bg-white/30 transition-all font-semibold"
                  >
                    <EmojiIcon label="âœ–ï¸" size={14} /> å–æ¶ˆ
                  </button>
                )}
              </div>
            </div>

            <div className="mt-6 bg-white/5 backdrop-blur-sm rounded-2xl p-4 border border-white/10 text-center">
              <p className="text-purple-200 text-sm">
                âœ¨ æ•°æ®å­˜å‚¨åœ¨ LeanCloud Â· é¡µé¢ä¼šæ¯ 8 ç§’è‡ªåŠ¨åˆ·æ–°ä¸€æ¬¡ï¼ˆä¹Ÿå¯å³ä¸Šè§’æ‰‹åŠ¨åˆ·æ–°ï¼‰
              </p>
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<CouponSystem />);
  </script>
</body>
</html>
